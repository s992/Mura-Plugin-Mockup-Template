var Porthole=(typeof Porthole=="undefined")||!Porthole?{}:Porthole;Porthole={trace:function(s){try{console.log("Porthole: "+s)}catch(e){}},error:function(s){try{console.error("Porthole: "+s)}catch(e){}}};Porthole.WindowProxy=function(){};Porthole.WindowProxy.prototype={postMessage:function(){},addEventListener:function(f){},removeEventListener:function(f){}};Porthole.WindowProxyLegacy=function(proxyIFrameUrl,targetWindowName){if(targetWindowName===undefined){targetWindowName=''}this.targetWindowName=targetWindowName;this.eventListeners=[];this.origin=window.location.protocol+'//'+window.location.host;if(proxyIFrameUrl!==null){this.proxyIFrameName=this.targetWindowName+'ProxyIFrame';this.proxyIFrameLocation=proxyIFrameUrl;this.proxyIFrameElement=this.createIFrameProxy()}else{this.proxyIFrameElement=null}};Porthole.WindowProxyLegacy.prototype={getTargetWindowName:function(){return this.targetWindowName},getOrigin:function(){return this.origin},createIFrameProxy:function(){var iframe=document.createElement("iframe");iframe.setAttribute('id',this.proxyIFrameName);iframe.setAttribute('name',this.proxyIFrameName);iframe.setAttribute('src',this.proxyIFrameLocation);iframe.setAttribute('frameBorder','1');iframe.setAttribute('scrolling','auto');iframe.setAttribute('width',30);iframe.setAttribute('height',30);iframe.setAttribute('style',"position: absolute; left: -100px; top:0px;");if(iframe.style.setAttribute){iframe.style.setAttribute('cssText',"position: absolute; left: -100px; top:0px;")}document.body.appendChild(iframe);return iframe},postMessage:function(data,targetOrigin){if(targetOrigin===undefined){targetOrigin='*'}if(this.proxyIFrameElement===null){Porthole.error("Can't send message because no proxy url was passed in the constructor")}else{sourceWindowName=window.name;this.proxyIFrameElement.setAttribute('src',this.proxyIFrameLocation+'#'+data+'&sourceOrigin='+escape(this.getOrigin())+'&targetOrigin='+escape(targetOrigin)+'&sourceWindowName='+sourceWindowName+'&targetWindowName='+this.targetWindowName);this.proxyIFrameElement.height=this.proxyIFrameElement.height>50?50:100}},addEventListener:function(f){this.eventListeners.push(f);return f},removeEventListener:function(f){try{var index=this.eventListeners.indexOf(f);this.eventListeners.splice(index,1)}catch(e){this.eventListeners=[];Porthole.error(e)}},dispatchEvent:function(e){for(var i=0;i<this.eventListeners.length;i++){try{this.eventListeners[i](e)}catch(ex){Porthole.error("Exception trying to call back listener: "+ex)}}}};Porthole.WindowProxyHTML5=function(proxyIFrameUrl,targetWindowName){if(targetWindowName===undefined){targetWindowName=''}this.targetWindowName=targetWindowName};Porthole.WindowProxyHTML5.prototype={postMessage:function(data,targetOrigin){if(targetOrigin===undefined){targetOrigin='*'}if(this.targetWindowName===''){targetWindow=top}else{targetWindow=parent.frames[this.targetWindowName]}targetWindow.postMessage(data,targetOrigin)},addEventListener:function(f){window.addEventListener("message",f,false);return f},removeEventListener:function(f){window.removeEventListener("message",f,false)},dispatchEvent:function(e){var evt=document.createEvent("MessageEvent");evt.initMessageEvent("message",true,true,e.data,e.origin,1,window,null);window.dispatchEvent(evt)}};if(typeof window.postMessage!='function'){Porthole.trace("Using legacy browser support");Porthole.WindowProxy=Porthole.WindowProxyLegacy;Porthole.WindowProxy.prototype=Porthole.WindowProxyLegacy.prototype}else{Porthole.trace("Using built-in browser support");Porthole.WindowProxy=Porthole.WindowProxyHTML5;Porthole.WindowProxy.prototype=Porthole.WindowProxyHTML5.prototype}Porthole.WindowProxy.splitMessageParameters=function(message){if(typeof message=='undefined'||message===null){return null}var hash=[];var pairs=message.split(/&/);for(var keyValuePairIndex in pairs){try{var nameValue=pairs[keyValuePairIndex].split('=');if(typeof(nameValue[1])=='undefined'){hash[nameValue[0]]=''}else{hash[nameValue[0]]=nameValue[1]}}catch(err){}}return hash};Porthole.MessageEvent=function MessageEvent(data,origin,source){this.data=data;this.origin=origin;this.source=source};Porthole.WindowProxyDispatcher={forwardMessageEvent:function(e){var message=document.location.hash;if(message.length>0){message=message.substr(1);m=Porthole.WindowProxyDispatcher.parseMessage(message);if(m.targetWindowName===''){targetWindow=top}else{targetWindow=parent.frames[m.targetWindowName]}var windowProxy=Porthole.WindowProxyDispatcher.findWindowProxyObjectInWindow(targetWindow,m.sourceWindowName);if(windowProxy){if(windowProxy.origin==m.targetOrigin||m.targetOrigin=='*'){e=new Porthole.MessageEvent(m.data,m.sourceOrigin,windowProxy);windowProxy.dispatchEvent(e)}else{Porthole.error("Target origin "+windowProxy.origin+" does not match desired target of "+m.targetOrigin)}}else{Porthole.error("Could not find window proxy object on the target window")}}},parseMessage:function(message){if(typeof message=='undefined'||message===null){return null}params=Porthole.WindowProxy.splitMessageParameters(message);var h={targetOrigin:'',sourceOrigin:'',sourceWindowName:'',data:''};h.targetOrigin=unescape(params.targetOrigin);h.sourceOrigin=unescape(params.sourceOrigin);h.sourceWindowName=unescape(params.sourceWindowName);h.targetWindowName=unescape(params.targetWindowName);var d=message.split(/&/);if(d.length>3){d.pop();d.pop();d.pop();d.pop();h.data=d.join('&')}return h},findWindowProxyObjectInWindow:function(w,sourceWindowName){if(w.RuntimeObject){w=w.RuntimeObject()}if(w){for(var i in w){try{if(w[i]!==null&&typeof w[i]=="object"&&w[i]instanceof w.Porthole.WindowProxy&&w[i].getTargetWindowName()==sourceWindowName){return w[i]}}catch(e){}}}return null},start:function(){if(window.addEventListener){window.addEventListener('resize',Porthole.WindowProxyDispatcher.forwardMessageEvent,false)}else if(document.body.attachEvent){window.attachEvent('onresize',Porthole.WindowProxyDispatcher.forwardMessageEvent)}else{Porthole.error("Can't attach resize event")}}};